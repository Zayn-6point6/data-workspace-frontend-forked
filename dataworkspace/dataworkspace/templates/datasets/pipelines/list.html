{% extends '_main.html' %}
{% load datasets_tags static %}
{% block page_title %}Pipelines - {{ block.super }}{% endblock page_title %}
{% block breadcrumbs %}
  <div class="govuk-breadcrumbs">
    <ol class="govuk-breadcrumbs__list">
      <li class="govuk-breadcrumbs__list-item">
        <a class="govuk-breadcrumbs__link" href="/">Home</a>
      </li>
      <li class="govuk-breadcrumbs__list-item">Pipelines
      </li>
    </ol>
  </div>
{% endblock breadcrumbs %}
{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-xl">Pipelines</h1>
      <dl class="govuk-summary-list">
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__value">
          <a class="govuk-link" href="{% url 'pipelines:create' %}">Add new pipeline</a>
          </dt>
          <dd class="govuk-summary-list__actions"></dd>
        </div>
      </dl>
      <div id="pipeline-grid" class="ag-theme-alpine dw-data-grid"></div>
    </div>
  </div>
  {% csrf_token %}
{% endblock %}
{% block footer_scripts %}
  <script src="{% static 'ag-grid-community.min.js' %}"></script>
  <script src="{% static 'data-grid.js' %}"></script>
  <script src="{% static 'js/pipeline-grid.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static 'data-grid.css' %}"/>
  <script nonce="{{ request.csp_nonce }}">
    var rowData = [
      {% for object in object_list %}
        {
          table_name: "{{ object.table_name }}",
          type: "{{ object.get_type_display }}",
          created_by: "{{ object.created_by.get_full_name }}",
          created_at: "{{ object.created_date }}",
          actions: {{ object.id }},
          edit_url: "{{ object.get_absolute_url }}",
          delete_url: "{{ object.get_delete_url }}",
          log_url: "{{ object.get_log_url }}",
          stop_url: "{{ object.get_stop_url }}",
          run_url: "{{ object.get_run_url }}",
          dag: {% if object.dag_details %}{{ object.dag_details|safe }}{% else %}null{% endif %},
          config: {{ object.config|safe }},
        },
      {% endfor %}
    ];
    initPipelineGrid(rowData);
  </script>
{% endblock footer_scripts %}